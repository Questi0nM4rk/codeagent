# =============================================================================
# AI Guardrails - Go Pre-Commit Hooks
# =============================================================================
# Pedantic Go enforcement: gofmt, go vet, golangci-lint.
# Uses go.mod for module configuration.
# =============================================================================

repos:
  - repo: local
    hooks:
      - id: go-fmt
        name: "go - gofmt check"
        entry: sh
        args: ["-c", "output=$(gofmt -l \"$@\") && [ -z \"$output\" ] || (echo \"$output\" && exit 1)", "--"]
        language: system
        types: [go]
        pass_filenames: true

      - id: go-vet
        name: "go - go vet"
        entry: go vet
        args: ["./..."]
        language: system
        types: [go]
        pass_filenames: false

      - id: go-mod-tidy
        name: "go - go mod tidy check"
        entry: sh
        args: ["-c", "go mod tidy && git diff --exit-code go.mod go.sum"]
        language: system
        files: go\.(mod|sum)$
        pass_filenames: false

  - repo: https://github.com/golangci/golangci-lint
    rev: v1.63.4
    hooks:
      - id: golangci-lint
        name: "go - golangci-lint (pedantic)"
        args:
          - "--enable-all"
          - "--disable=exhaustruct"  # Too strict for most projects
          - "--disable=depguard"     # Requires config file
          - "--disable=wrapcheck"    # Too noisy for small projects

  - repo: local
    hooks:
      - id: go-vulncheck
        name: "go - govulncheck CVE scan"
        entry: govulncheck
        args: ["./..."]
        language: system
        types: [go]
        pass_filenames: false
